<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NanTube</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <style>
        /* Все стили остаются как есть */
        .youtube-videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 40px 16px;
            padding: 0 8px;
            width: 100%;
        }

        /* ... остальные стили ... */

        /* Стили для секции Shorts */
        .shorts-section {
            margin: 40px 0;
            padding: 20px;
            background-color: var(--surface);
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .shorts-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .shorts-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .shorts-title svg {
            width: 24px;
            height: 24px;
            fill: var(--primary-orange);
        }

        .shorts-title h3 {
            font-size: 22px;
            font-weight: 700;
            color: var(--on-background);
            margin: 0;
        }

        .shorts-show-all {
            color: var(--primary-orange);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            padding: 8px 16px;
            border-radius: 8px;
            background-color: rgba(255, 107, 53, 0.1);
            transition: all 0.3s;
        }

        .shorts-show-all:hover {
            background-color: rgba(255, 107, 53, 0.2);
        }

        /* Grid для Shorts (6 карточек в ряд на ПК) */
        .shorts-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 16px;
        }

        .shorts-grid.mobile {
            grid-template-columns: 1fr;
        }

        @media (max-width: 1200px) {
            .shorts-grid:not(.mobile) {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        @media (max-width: 992px) {
            .shorts-grid:not(.mobile) {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .shorts-grid:not(.mobile) {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .shorts-section {
                padding: 16px;
                margin: 24px 0;
            }
            
            .shorts-header {
                margin-bottom: 16px;
            }
            
            .shorts-title h3 {
                font-size: 18px;
            }
        }

        /* На телефонах показываем только 1 шортс */
        @media (max-width: 480px) {
            .shorts-grid:not(.mobile) {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .shorts-card {
                max-width: 100%;
                margin: 0 auto;
            }
            
            .shorts-thumbnail {
                padding-bottom: 177.78%;
                border-radius: 10px;
            }
            
            .shorts-info {
                padding: 8px 0 0 0;
            }
            
            .shorts-title-text {
                font-size: 15px;
                font-weight: 600;
                line-height: 1.3;
                margin-bottom: 4px;
            }
            
            .shorts-stats {
                font-size: 13px;
            }
            
            .shorts-section {
                padding: 16px 12px;
                margin: 20px 0;
                border-radius: 12px;
            }
            
            .shorts-title h3 {
                font-size: 16px;
            }
            
            .shorts-show-all {
                font-size: 13px;
                padding: 6px 12px;
            }
        }

        /* Дополнительно: улучшаем отображение на очень узких экранах */
        @media (max-width: 360px) {
            .shorts-grid:not(.mobile) {
                gap: 12px;
            }
            
            .shorts-section {
                padding: 12px 10px;
                margin: 16px 0;
            }
            
            .shorts-thumbnail {
                border-radius: 8px;
            }
            
            .shorts-overlay {
                width: 36px;
                height: 36px;
                top: 10px;
                left: 10px;
            }
            
            .shorts-overlay svg {
                width: 20px;
                height: 20px;
            }
        }

        /* Стили для горизонтальных видео на мобильных */
        @media (max-width: 768px) {
            .youtube-videos-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 24px 12px;
                padding: 0 4px;
            }
            
            .horizontal-videos-section {
                margin-bottom: 20px;
            }
        }

        @media (max-width: 480px) {
            .youtube-videos-grid {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 0;
            }
            
            .youtube-video-card {
                margin: 0;
                border-radius: 0;
                border-bottom: 1px solid var(--border);
                padding-bottom: 12px;
            }
            
            .video-thumbnail-container {
                border-radius: 8px;
            }
            
            .container {
                padding: 0 12px;
            }
        }

        .shorts-card {
            text-decoration: none;
            color: inherit;
            cursor: pointer;
            display: block;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s;
        }

        .shorts-card:hover {
            transform: translateY(-4px);
        }

        .shorts-thumbnail {
            position: relative;
            width: 100%;
            padding-bottom: 177.78%; /* 9:16 aspect ratio */
            border-radius: 12px;
            overflow: hidden;
            background-color: #000;
            margin-bottom: 8px;
        }

        .shorts-thumbnail video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .shorts-card:hover .shorts-thumbnail video {
            transform: scale(1.05);
        }

        .shorts-overlay {
            position: absolute;
            top: 12px;
            left: 12px;
            background: linear-gradient(135deg, #ff6d00, #ff8e53);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .shorts-overlay svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .shorts-info {
            padding: 0 4px;
        }

        .shorts-title-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--on-background);
            margin: 0 0 4px 0;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
        }

        .shorts-title-text:hover {
            color: var(--primary-orange);
        }

        .shorts-stats {
            font-size: 12px;
            color: var(--on-surface);
        }

        /* Счетчики для отладки */
        .debug-info {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 12px;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Шапка без изменений -->
    <header class="youtube-header">
        <div class="header-left">
            <button class="menu-toggle" id="menuToggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 18H21V16H3V18ZM3 13H21V11H3V13ZM3 6V8H21V6H3Z" fill="currentColor"/>
                </svg>
            </button>
            <a href="{{ url_for('index') }}" class="logo">
                <div class="logo-container">
                    <div class="logo-icon">
                        <svg width="90" height="20" viewBox="0 0 90 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M27.58 10.22L25.24 7.88V12.56L27.58 10.22Z" fill="#FF6B35"/>
                            <path d="M19.67 4.34C17.45 4.34 15.64 6.15 15.64 8.37V11.63C15.64 13.85 17.45 15.66 19.67 15.66C21.89 15.66 23.7 13.85 23.7 11.63V8.37C23.7 6.15 21.89 4.34 19.67 4.34Z" fill="#FF6B35"/>
                        </svg>
                    </div>
                    <span class="logo-text">NanTube</span>
                </div>
            </a>
        </div>
        
        <!-- Поисковая строка -->
        <div class="search-container youtube-search">
            <div class="search-box youtube-search-box">
                <input type="text" class="search-input youtube-search-input" id="searchInput" 
                       placeholder="Поиск видео...">
                <button class="search-button youtube-search-button" id="searchButton">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z" fill="currentColor"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="header-right">
            <a href="{{ url_for('upload_file') }}" class="header-btn upload-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 13V17H10V13H7L12 8L17 13H14ZM19 19H5V21H19V19Z" fill="currentColor"/>
                </svg>
                <span class="btn-text">Загрузить</span>
            </a>
            <a href="{{ url_for('settings') }}" class="header-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 15.5C13.93 15.5 15.5 13.93 15.5 12C15.5 10.07 13.93 8.5 12 8.5C10.07 8.5 8.5 10.07 8.5 12C8.5 13.93 10.07 15.5 12 15.5ZM12 10.5C12.83 10.5 13.5 11.17 13.5 12C13.5 12.83 12.83 13.5 12 13.5C11.17 13.5 10.5 12.83 10.5 12C10.5 11.17 11.17 10.5 12 10.5ZM5.05 19H7C7 17.9 7.9 17 9 17H15C16.1 17 17 17.9 17 19H18.95C18.45 15.17 15.83 12.55 12 12.05V10H10V12.05C6.17 12.55 3.55 15.17 3.05 19H5.05ZM19 19H21C20.5 14.83 17.17 11.5 13 11V9H11V11C6.83 11.5 3.5 14.83 3 19H5C5.5 15.83 8.17 13 12 13C15.83 13 18.5 15.83 19 19Z" fill="currentColor"/>
                </svg>
            </a>
            <button class="theme-toggle header-btn" id="themeToggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM12 20V4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20Z" fill="currentColor"/>
                </svg>
            </button>
            <div class="user-avatar">NT</div>
        </div>
    </header>

    <div class="youtube-layout">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="{{ url_for('index') }}" class="sidebar-item active">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 20V14H14V20H19V12H22L12 3L2 12H5V20H10Z" fill="currentColor"/>
                    </svg>
                    Главная
                </a>
                <a href="{{ url_for('random_vertical') }}" class="sidebar-item">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.77 10.32c-.77-.32-1.2-.5-1.2-.5L18 9.06c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29l-3.06 1.68c-.65-.34-1.17-.5-1.17-.5L10 7.5c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29L4.5 8.5c-1.2.66-1.65 2.1-.99 3.3.66 1.2 2.1 1.65 3.3.99l3.06-1.68c.65.34 1.17.5 1.17.5L11 14.5c-1.84.96-2.15 4.71-.39 5.65 1.76.94 4.08-.52 4.3-2.58.09-.84-.14-1.63-.57-2.29l3.06-1.68c1.2-.66 1.65-2.1.99-3.3-.66-1.2-2.1-1.65-3.3-.99z" fill="currentColor"/>
                    </svg>
                    Shorts
                </a>
                <a href="{{ url_for('upload_file') }}" class="sidebar-item">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14 13V17H10V13H7L12 8L17 13H14ZM19 19H5V21H19V19Z" fill="currentColor"/>
                    </svg>
                    Загрузить
                </a>
                <a href="{{ url_for('settings') }}" class="sidebar-item">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 15.5C13.93 15.5 15.5 13.93 15.5 12C15.5 10.07 13.93 8.5 12 8.5C10.07 8.5 8.5 10.07 8.5 12C8.5 13.93 10.07 15.5 12 15.5ZM12 10.5C12.83 10.5 13.5 11.17 13.5 12C13.5 12.83 12.83 13.5 12 13.5C11.17 13.5 10.5 12.83 10.5 12C10.5 11.17 11.17 10.5 12 10.5ZM5.05 19H7C7 17.9 7.9 17 9 17H15C16.1 17 17 17.9 17 19H18.95C18.45 15.17 15.83 12.55 12 12.05V10H10V12.05C6.17 12.55 3.55 15.17 3.05 19H5.05ZM19 19H21C20.5 14.83 17.17 11.5 13 11V9H11V11C6.83 11.5 3.5 14.83 3 19H5C5.5 15.83 8.17 13 12 13C15.83 13 18.5 15.83 19 19Z" fill="currentColor"/>
                    </svg>
                    Настройки
                </a>
            </nav>
        </aside>

        <main class="youtube-main">
            <div class="container">
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        <ul class="flash-messages">
                        {% for message in messages %}
                            <li class="{% if 'успешно' in message %}flash-success{% else %}flash-error{% endif %}">
                                {{ message }}
                            </li>
                        {% endfor %}
                        </ul>
                    {% endif %}
                {% endwith %}

                {% if search_term %}
                <div class="search-results-header">
                    <h2>Результаты поиска: "{{ search_term }}"</h2>
                    <a href="{{ url_for('index') }}" class="back-link">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Вернуться ко всем видео
                    </a>
                </div>
                {% endif %}

                <!-- ЦИКЛИЧЕСКОЕ ОТОБРАЖЕНИЕ: 4 строки горизонтальных, 1 вертикальных -->
                {% if videos %}
                    {% if search_term %}
                        <!-- ПРИ ПОИСКЕ: все видео вместе -->
                        <div class="youtube-videos-grid">
                            {% for video in videos %}
                                {% set filename = video[0] %}
                                {% set display_name = video[1] %}
                                {% set orientation = video[2] if video|length > 2 else 'horizontal' %}
                                
                                <div class="youtube-video-card">
                                    <a href="{% if orientation == 'vertical' %}{{ url_for('vertical_video', filename=filename) }}{% else %}{{ url_for('watch_video', filename=filename) }}{% endif %}" 
                                       class="video-link">
                                        <div class="video-thumbnail-container">
                                            <div class="thumbnail-wrapper {% if orientation == 'vertical' %}vertical{% endif %}">
                                                {% if orientation == 'vertical' %}
                                                    <div class="vertical-badge">
                                                        <svg width="12" height="12" viewBox="0 0 24 24">
                                                            <path d="M17.77 10.32c-.77-.32-1.2-.5-1.2-.5L18 9.06c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29l-3.06 1.68c-.65-.34-1.17-.5-1.17-.5L10 7.5c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29L4.5 8.5c-1.2.66-1.65 2.1-.99 3.3.66 1.2 2.1 1.65 3.3.99l3.06-1.68c.65.34 1.17.5 1.17.5L11 14.5c-1.84.96-2.15 4.71-.39 5.65 1.76.94 4.08-.52 4.3-2.58.09-.84-.14-1.63-.57-2.29l3.06-1.68c1.2-.66 1.65-2.1.99-3.3-.66-1.2-2.1-1.65-3.3-.99z"/>
                                                        </svg>
                                                        Shorts
                                                    </div>
                                                {% endif %}
                                                <video preload="metadata" onloadedmetadata="setVideoDuration(this, '{{ loop.index }}')">
                                                    <source src="{{ url_for('serve_video', filename=filename) }}" type="video/mp4">
                                                </video>
                                                <span class="video-duration" id="duration-{{ loop.index }}">--:--</span>
                                            </div>
                                        </div>
                                        <div class="video-info-container">
                                            <div class="channel-avatar">NT</div>
                                            <div class="video-details">
                                                <h3 class="video-title">{{ display_name }}</h3>
                                                <div class="channel-name">NanTube</div>
                                                <div class="video-metadata">
                                                    <span class="views">{% if orientation == 'vertical' %}100+ просмотров{% else %}1K+ просмотров{% endif %}</span>
                                                    <span class="time-ago">• 1 день назад</span>
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- ЦИКЛИЧЕСКОЕ ЧЕРЕДОВАНИЕ: 4 строки горизонтальных, 1 строка вертикальных -->
                        {% set horizontal_videos = [] %}
                        {% set vertical_videos = [] %}
                        
                        {% for video in videos %}
                            {% if video[2] == 'vertical' %}
                                {% if vertical_videos.append(video) %}{% endif %}
                            {% else %}
                                {% if horizontal_videos.append(video) %}{% endif %}
                            {% endif %}
                        {% endfor %}
                        
                        <!-- Используем for loop вместо while -->
                        {% for cycle in range(0, (horizontal_videos|length + 11)//12 + (vertical_videos|length + 5)//6) %}
                            <!-- Горизонтальные видео (12 видео = 4 строки по 3) -->
                            {% set h_start = cycle * 12 %}
                            {% set h_end = h_start + 12 %}
                            
                            {% if h_start < horizontal_videos|length %}
                            <div class="horizontal-videos-section" id="horizontal-cycle-{{ cycle + 1 }}">
                                <div class="youtube-videos-grid">
                                    {% for i in range(h_start, h_end if h_end < horizontal_videos|length else horizontal_videos|length) %}
                                        {% set video = horizontal_videos[i] %}
                                        {% set filename = video[0] %}
                                        {% set display_name = video[1] %}
                                        
                                        <div class="youtube-video-card">
                                            <a href="{{ url_for('watch_video', filename=filename) }}" 
                                               class="video-link">
                                                <div class="video-thumbnail-container">
                                                    <div class="thumbnail-wrapper">
                                                        <video preload="metadata" onloadedmetadata="setVideoDurationHorizontal(this, '{{ cycle + 1 }}-{{ i }}')">
                                                            <source src="{{ url_for('serve_video', filename=filename) }}" type="video/mp4">
                                                        </video>
                                                        <span class="video-duration" id="duration-h-{{ cycle + 1 }}-{{ i }}">--:--</span>
                                                    </div>
                                                </div>
                                                <div class="video-info-container">
                                                    <div class="channel-avatar">NT</div>
                                                    <div class="video-details">
                                                        <h3 class="video-title">{{ display_name }}</h3>
                                                        <div class="channel-name">NanTube</div>
                                                        <div class="video-metadata">
                                                            <span class="views">1K+ просмотров</span>
                                                            <span class="time-ago">• 1 день назад</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Вертикальные видео (Shorts) - только если есть вертикальные видео -->
                            {% set v_start = cycle * 6 %}
                            {% set v_end = v_start + 6 %}
                            
                            {% if v_start < vertical_videos|length %}
                            <div class="shorts-section" id="vertical-cycle-{{ cycle + 1 }}">
                                <div class="shorts-header">
                                    <div class="shorts-title">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17.77 10.32c-.77-.32-1.2-.5-1.2-.5L18 9.06c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29l-3.06 1.68c-.65-.34-1.17-.5-1.17-.5L10 7.5c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29L4.5 8.5c-1.2.66-1.65 2.1-.99 3.3.66 1.2 2.1 1.65 3.3.99l3.06-1.68c.65.34 1.17.5 1.17.5L11 14.5c-1.84.96-2.15 4.71-.39 5.65 1.76.94 4.08-.52 4.3-2.58.09-.84-.14-1.63-.57-2.29l3.06-1.68c1.2-.66 1.65-2.1.99-3.3-.66-1.2-2.1-1.65-3.3-.99z" fill="currentColor"/>
                                        </svg>
                                        <h3>Shorts (Блок {{ cycle + 1 }})</h3>
                                    </div>
                                    <a href="{{ url_for('random_vertical') }}" class="shorts-show-all">
                                        Смотреть все
                                    </a>
                                </div>
                                
                                <!-- Здесь меняем логику отображения шортсов -->
                                <div class="shorts-grid" id="shorts-grid-{{ cycle + 1 }}">
                                    {% for i in range(v_start, v_end if v_end < vertical_videos|length else vertical_videos|length) %}
                                        {% set video = vertical_videos[i] %}
                                        {% set filename = video[0] %}
                                        {% set display_name = video[1] %}
                                        
                                        <a href="{{ url_for('vertical_video', filename=filename) }}" class="shorts-card">
                                            <div class="shorts-thumbnail">
                                                <video preload="metadata">
                                                    <source src="{{ url_for('serve_video', filename=filename) }}" type="video/mp4">
                                                </video>
                                                <div class="shorts-overlay">
                                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M17.77 10.32c-.77-.32-1.2-.5-1.2-.5L18 9.06c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29l-3.06 1.68c-.65-.34-1.17-.5-1.17-.5L10 7.5c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29L4.5 8.5c-1.2.66-1.65 2.1-.99 3.3.66 1.2 2.1 1.65 3.3.99l3.06-1.68c.65.34 1.17.5 1.17.5L11 14.5c-1.84.96-2.15 4.71-.39 5.65 1.76.94 4.08-.52 4.3-2.58.09-.84-.14-1.63-.57-2.29l3.06-1.68c1.2-.66 1.65-2.1.99-3.3-.66-1.2-2.1-1.65-3.3-.99z" fill="white"/>
                                                    </svg>
                                                </div>
                                            </div>
                                            <div class="shorts-info">
                                                <h4 class="shorts-title-text">{{ display_name }}</h4>
                                                <div class="shorts-stats">100+ просмотров</div>
                                            </div>
                                        </a>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Проверка, нужно ли продолжать цикл -->
                            {% if h_end >= horizontal_videos|length and v_end >= vertical_videos|length %}
                                <!-- Прерываем цикл, если видео обоих типов закончились -->
                            {% endif %}
                        {% endfor %}
                        
                        <!-- Если нет ни горизонтальных, ни вертикальных видео -->
                        {% if horizontal_videos|length == 0 and vertical_videos|length == 0 %}
                            <div class="empty-state">
                                <h2>Нет доступных видео</h2>
                                <p>Загрузите первое видео, нажав кнопку "Загрузить"</p>
                                <a href="{{ url_for('upload_file') }}">Загрузить видео</a>
                            </div>
                        {% endif %}
                    {% endif %}
                {% else %}
                    <div class="empty-state">
                        <h2>Нет доступных видео</h2>
                        <p>Загрузите первое видео, нажав кнопку "Загрузить"</p>
                        <a href="{{ url_for('upload_file') }}">Загрузить видео</a>
                    </div>
                {% endif %}
            </div>
        </main>
    </div>

    <!-- Мобильная навигация -->
    <nav class="mobile-nav">
        <a href="{{ url_for('index') }}" class="mobile-nav-item active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 20V14H14V20H19V12H22L12 3L2 12H5V20H10Z" fill="currentColor"/>
            </svg>
            <span>Главная</span>
        </a>
        <a href="{{ url_for('random_vertical') }}" class="mobile-nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.77 10.32c-.77-.32-1.2-.5-1.2-.5L18 9.06c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29l-3.06 1.68c-.65-.34-1.17-.5-1.17-.5L10 7.5c1.84-.96 2.15-4.71.39-5.65-1.76-.94-4.08.52-4.3 2.58-.09.84.14 1.63.57 2.29L4.5 8.5c-1.2.66-1.65 2.1-.99 3.3.66 1.2 2.1 1.65 3.3.99l3.06-1.68c.65.34 1.17.5 1.17.5L11 14.5c-1.84.96-2.15 4.71-.39 5.65 1.76.94 4.08-.52 4.3-2.58.09-.84-.14-1.63-.57-2.29l3.06-1.68c1.2-.66 1.65-2.1.99-3.3-.66-1.2-2.1-1.65-3.3-.99z" fill="currentColor"/>
            </svg>
            <span>Shorts</span>
        </a>
        <a href="{{ url_for('upload_file') }}" class="mobile-nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 13V17H10V13H7L12 8L17 13H14ZM19 19H5V21H19V19Z" fill="currentColor"/>
            </svg>
            <span>Загрузить</span>
        </a>
        <a href="{{ url_for('settings') }}" class="mobile-nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 15.5C13.93 15.5 15.5 13.93 15.5 12C15.5 10.07 13.93 8.5 12 8.5C10.07 8.5 8.5 10.07 8.5 12C8.5 13.93 10.07 15.5 12 15.5ZM12 10.5C12.83 10.5 13.5 11.17 13.5 12C13.5 12.83 12.83 13.5 12 13.5C11.17 13.5 10.5 12.83 10.5 12C10.5 11.17 11.17 10.5 12 10.5ZM5.05 19H7C7 17.9 7.9 17 9 17H15C16.1 17 17 17.9 17 19H18.95C18.45 15.17 15.83 12.55 12 12.05V10H10V12.05C6.17 12.55 3.55 15.17 3.05 19H5.05ZM19 19H21C20.5 14.83 17.17 11.5 13 11V9H11V11C6.83 11.5 3.5 14.83 3 19H5C5.5 15.83 8.17 13 12 13C15.83 13 18.5 15.83 19 19Z" fill="currentColor"/>
            </svg>
            <span>Настройки</span>
        </a>
    </nav>

    <script>
        // Функция для установки длительности видео
        function setVideoDuration(video, index) {
            const durationElement = document.getElementById(`duration-${index}`);
            if (durationElement && !isNaN(video.duration)) {
                const minutes = Math.floor(video.duration / 60);
                const seconds = Math.floor(video.duration % 60);
                durationElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // Функция для установки длительности горизонтальных видео
        function setVideoDurationHorizontal(video, index) {
            const durationElement = document.getElementById(`duration-h-${index}`);
            if (durationElement && !isNaN(video.duration)) {
                const minutes = Math.floor(video.duration / 60);
                const seconds = Math.floor(video.duration % 60);
                durationElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // Функция для рандомизации горизонтальных видео в КАЖДОМ цикле
        function shuffleAllHorizontalVideos() {
            if (!document.querySelector('.search-results-header')) {
                // Находим все секции с горизонтальными видео
                const horizontalSections = document.querySelectorAll('.horizontal-videos-section');
                
                horizontalSections.forEach((section, sectionIndex) => {
                    const videoGrid = section.querySelector('.youtube-videos-grid');
                    if (videoGrid) {
                        const videoCards = Array.from(videoGrid.querySelectorAll('.youtube-video-card'));
                        
                        // Перемешиваем карточки внутри этой секции
                        for (let i = videoCards.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            videoGrid.insertBefore(videoCards[j], videoCards[i]);
                        }
                    }
                });
            }
        }

        // Функция для адаптивного отображения шортсов
        function adaptShortsForMobile() {
            const shortsGrids = document.querySelectorAll('.shorts-grid');
            const isMobile = window.innerWidth <= 480;
            
            shortsGrids.forEach(grid => {
                if (isMobile) {
                    grid.classList.add('mobile');
                    
                    // На мобильных оставляем только 1 шортс
                    const shortsCards = grid.querySelectorAll('.shorts-card');
                    if (shortsCards.length > 1) {
                        // Скрываем все кроме первого
                        for (let i = 1; i < shortsCards.length; i++) {
                            shortsCards[i].style.display = 'none';
                        }
                    }
                } else {
                    grid.classList.remove('mobile');
                    
                    // На десктопе показываем все
                    const shortsCards = grid.querySelectorAll('.shorts-card');
                    shortsCards.forEach(card => {
                        card.style.display = 'block';
                    });
                }
            });
        }

        // Поиск видео
        document.getElementById('searchButton').addEventListener('click', function() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (searchTerm) {
                window.location.href = '{{ url_for("index") }}?search=' + encodeURIComponent(searchTerm);
            }
        });

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchTerm = this.value.trim();
                if (searchTerm) {
                    window.location.href = '{{ url_for("index") }}?search=' + encodeURIComponent(searchTerm);
                }
            }
        });

        // Переключение темы
        document.getElementById('themeToggle').addEventListener('click', function() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            
            localStorage.setItem('theme', newTheme);
            
            if (newTheme === 'dark') {
                this.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20Z" fill="currentColor"/></svg>';
            } else {
                this.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM12 20V4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20Z" fill="currentColor"/></svg>';
            }
        });

        // Восстановление темы при загрузке
        window.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                if (savedTheme === 'dark') {
                    themeToggle.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 7C14.76 7 17 9.24 17 12C17 14.76 14.76 17 12 17C9.24 17 7 14.76 7 12C7 9.24 9.24 7 12 7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.58 20 4 16.42 4 12C4 7.58 7.58 4 12 4C16.42 4 20 7.58 20 12C20 16.42 16.42 20 12 20Z" fill="currentColor"/></svg>';
                } else {
                    themeToggle.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM12 20V4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20Z" fill="currentColor"/></svg>';
                }
            }
            
            // Рандомизация горизонтальных видео во всех циклах при загрузке
            setTimeout(shuffleAllHorizontalVideos, 100);
            
            // Адаптация шортсов для мобильных устройств
            adaptShortsForMobile();
            
            // Обработка изменения размера окна
            window.addEventListener('resize', adaptShortsForMobile);
        });
    </script>
</body>
</html>